package org.modelix.model.mpsadapters.mps;

/*Generated by MPS */

import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import org.modelix.model.api.INode;
import org.jetbrains.mps.openapi.module.SModuleReference;
import org.jetbrains.mps.openapi.module.SModule;
import org.jetbrains.mps.openapi.model.SModel;
import org.jetbrains.annotations.NotNull;
import org.modelix.model.area.IArea;
import org.modelix.model.api.INodeReference;
import org.jetbrains.annotations.Nullable;
import org.modelix.model.api.IConcept;
import jetbrains.mps.internal.collections.runtime.LinkedListSequence;
import java.util.LinkedList;
import java.util.Collections;
import org.modelix.model.api.IChildLink;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.internal.collections.runtime.ISelector;
import jetbrains.mps.internal.collections.runtime.ITranslator2;
import org.modelix.model.api.IConceptReference;
import java.util.Objects;
import java.util.List;
import org.modelix.model.api.IProperty;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import org.modelix.model.api.IReferenceLink;
import org.jetbrains.mps.openapi.model.SModelReference;
import org.jetbrains.mps.openapi.module.SModuleId;
import org.jetbrains.mps.openapi.module.SRepository;
import jetbrains.mps.internal.collections.runtime.NotNullWhereFilter;
import jetbrains.mps.smodel.MPSModuleRepository;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class DevKitDependencyAsNode implements INode {
  private SModuleReference moduleReference;
  private SModule moduleImporter;
  private SModel modelImporter;

  public DevKitDependencyAsNode(SModuleReference moduleReference, SModule importer) {
    this.moduleReference = moduleReference;
    this.moduleImporter = importer;
  }

  public DevKitDependencyAsNode(SModuleReference moduleReference, SModel importer) {
    this.moduleReference = moduleReference;
    this.modelImporter = importer;
  }

  @NotNull
  @Override
  public IArea getArea() {
    return new MPSArea();
  }

  @Override
  public boolean isValid() {
    return true;
  }

  @NotNull
  @Override
  public INodeReference getReference() {
    if (this.moduleImporter != null) {
      return new NodeReference(this.moduleImporter.getModuleReference(), this.moduleReference.getModuleId());
    }
    if (this.modelImporter != null) {
      return new NodeReference(this.modelImporter.getReference(), this.moduleReference.getModuleId());
    }
    throw new IllegalStateException();
  }

  @Nullable
  @Override
  public IConcept getConcept() {
    return SConceptAdapter.wrap(CONCEPTS.DevkitDependency$Ns);
  }

  @Nullable
  @Override
  public String getRoleInParent() {
    if (this.moduleImporter != null) {
      return LINKS.languageDependencies$vKlY.getName();
    }
    if (this.modelImporter != null) {
      return LINKS.usedLanguages$QK4E.getName();
    }
    throw new IllegalStateException();
  }

  @Nullable
  @Override
  public INode getParent() {
    if (this.moduleImporter != null) {
      SModuleAsNode.wrap(this.moduleImporter);
    }
    if (this.modelImporter != null) {
      SModelAsNode.wrap(this.modelImporter);
    }
    throw new IllegalStateException();
  }

  @NotNull
  @Override
  public Iterable<INode> getChildren(@Nullable String role) {
    return LinkedListSequence.fromLinkedListNew(new LinkedList<INode>());
  }

  @NotNull
  @Override
  public Iterable<INode> getAllChildren() {
    IConcept concept = getConcept();
    if (concept == null) {
      return Collections.<INode>emptyList();
    }
    Iterable<IChildLink> links = concept.getAllChildLinks();
    return Sequence.fromIterable(links).select(new ISelector<IChildLink, Iterable<INode>>() {
      public Iterable<INode> select(IChildLink it) {
        return getChildren(it.getName());
      }
    }).translate(new ITranslator2<Iterable<INode>, INode>() {
      public Iterable<INode> translate(Iterable<INode> it) {
        return it;
      }
    });
  }

  @Override
  public void moveChild(@Nullable String string, int i, @NotNull INode node) {
    throw new UnsupportedOperationException();
  }

  @NotNull
  @Override
  public INode addNewChild(@Nullable String string, int i, @Nullable IConcept concept) {
    throw new UnsupportedOperationException();
  }
  @NotNull
  @Override
  public INode addNewChild(@Nullable String string, int i, @Nullable IConceptReference reference) {
    throw new UnsupportedOperationException();
  }

  @Override
  public void removeChild(@NotNull INode node) {
    throw new UnsupportedOperationException();
  }

  @Nullable
  @Override
  public INode getReferenceTarget(@NotNull String role) {
    return null;
  }
  @Nullable
  @Override
  public INodeReference getReferenceTargetRef(@NotNull String string) {
    return null;
  }

  @Override
  public void setReferenceTarget(@NotNull String string, @Nullable INode node) {
    throw new UnsupportedOperationException();
  }
  @Override
  public void setReferenceTarget(@NotNull String string, @Nullable INodeReference reference) {
    throw new UnsupportedOperationException();
  }

  @Nullable
  @Override
  public String getPropertyValue(@NotNull String propertyName) {
    if (Objects.equals(PROPS.name$lpYq.getName(), propertyName)) {
      return this.moduleReference.getModuleName();
    } else if (Objects.equals(PROPS.uuid$lpJp.getName(), propertyName)) {
      return this.moduleReference.getModuleId().toString();
    } else {
      return null;
    }
  }
  @Override
  public void setPropertyValue(@NotNull String string, @Nullable String string1) {
    throw new UnsupportedOperationException();
  }

  @NotNull
  @Override
  public List<String> getPropertyRoles() {
    IConcept concept = getConcept();
    if (concept == null) {
      return Collections.<String>emptyList();
    }
    List<IProperty> allProperties = concept.getAllProperties();
    return ListSequence.fromList(allProperties).select(new ISelector<IProperty, String>() {
      public String select(IProperty it) {
        return it.getName();
      }
    }).toListSequence();
  }

  @NotNull
  @Override
  public List<String> getReferenceRoles() {
    IConcept concept = getConcept();
    if (concept == null) {
      return Collections.<String>emptyList();
    }
    List<IReferenceLink> allReferenceLinks = concept.getAllReferenceLinks();
    return ListSequence.fromList(allReferenceLinks).select(new ISelector<IReferenceLink, String>() {
      public String select(IReferenceLink it) {
        return it.getName();
      }
    }).toListSequence();
  }

  public static class NodeReference implements INodeReference {
    private SModuleReference userModuleReference;
    private SModelReference userModel;
    private SModuleId usedModuleId;

    public NodeReference(SModuleReference userModuleReference, SModuleId usedModuleId) {
      this.userModuleReference = userModuleReference;
      this.usedModuleId = usedModuleId;
    }

    public NodeReference(SModelReference userModel, SModuleId usedModuleId) {
      this.userModel = userModel;
      this.usedModuleId = usedModuleId;
    }

    @Nullable
    @Override
    public INode resolveNode(@Nullable IArea area) {
      SRepository repo = null;
      if (area != null) {
        List<IArea> areas = area.collectAreas();
        repo = ListSequence.fromList(areas).ofType(MPSArea.class).select(new ISelector<MPSArea, SRepository>() {
          public SRepository select(MPSArea it) {
            return it.getRepository();
          }
        }).where((_FunctionTypes._return_P1_E0<Boolean, SRepository>) (_FunctionTypes._return_P1_E0) new NotNullWhereFilter()).first();
      }
      if (repo == null) {
        repo = MPSModuleRepository.getInstance();
      }

      if (this.userModuleReference != null) {
        SModule user = userModuleReference.resolve(repo);
        if (user == null) {
          return null;
        }

        return new SModuleAsNode(user).findDevKitDependency(this.usedModuleId);
      } else if (this.userModel != null) {
        SModel model = userModel.resolve(repo);
        return new SModelAsNode(model).findDevKitDependency(this.usedModuleId);
      } else {
        throw new IllegalStateException();
      }
    }

    @Override
    public boolean equals(Object o) {
      if (this == o) {
        return true;
      }
      if (o == null || this.getClass() != o.getClass()) {
        return false;
      }

      NodeReference that = (NodeReference) o;
      if (Objects.equals(this.userModuleReference, that.userModuleReference)) {
        return false;
      }
      if (Objects.equals(this.userModel, that.userModel)) {
        return false;
      }
      if (Objects.equals(this.usedModuleId, that.usedModuleId)) {
        return false;
      }

      return true;
    }

    @Override
    public int hashCode() {
      int result = 0;
      result = 31 * result + ((userModuleReference != null ? ((Object) userModuleReference).hashCode() : 0));
      result = 11 * result + ((usedModuleId != null ? ((Object) usedModuleId).hashCode() : 0));
      result = 37 * result + ((userModel != null ? ((Object) userModel).hashCode() : 0));
      return result;
    }
  }

  @Nullable
  @Override
  public IConceptReference getConceptReference() {
    return check_d9amqo_a0a64(getConcept(), this);
  }
  private static IConceptReference check_d9amqo_a0a64(IConcept checkedDotOperand, DevKitDependencyAsNode checkedDotThisExpression) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getReference();
    }
    return null;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept DevkitDependency$Ns = MetaAdapterFactory.getConcept(0xa7577d1d4e5431dL, 0x98b1fae38f9aee80L, 0x7c527144386aca16L, "org.modelix.model.repositoryconcepts.structure.DevkitDependency");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink languageDependencies$vKlY = MetaAdapterFactory.getContainmentLink(0xa7577d1d4e5431dL, 0x98b1fae38f9aee80L, 0x69652614fd1c50fL, 0x1e9fde9535299187L, "languageDependencies");
    /*package*/ static final SContainmentLink usedLanguages$QK4E = MetaAdapterFactory.getContainmentLink(0xa7577d1d4e5431dL, 0x98b1fae38f9aee80L, 0x69652614fd1c50cL, 0x4aaf28cf2092e98eL, "usedLanguages");
  }

  private static final class PROPS {
    /*package*/ static final SProperty uuid$lpJp = MetaAdapterFactory.getProperty(0xa7577d1d4e5431dL, 0x98b1fae38f9aee80L, 0x7c527144386aca0fL, 0x7c527144386aca12L, "uuid");
    /*package*/ static final SProperty name$lpYq = MetaAdapterFactory.getProperty(0xa7577d1d4e5431dL, 0x98b1fae38f9aee80L, 0x7c527144386aca0fL, 0x7c527144386aca13L, "name");
  }
}
